@page "/categories/create"
@inject ApplicationDbContext DbContext
@inject UserState UserState
@inject NavigationManager Navigation

<PageTitle>Add Category</PageTitle>

<h1>➕ Add New Category</h1>

<EditForm Model="@category" OnValidSubmit="HandleSubmit">
    <DataAnnotationsValidator />
    <ValidationSummary class="text-danger small" />

    <div class="mb-3">
        <label>Name:</label>
        <InputText @bind-Value="category.Name" class="form-control" />
        <ValidationMessage For="@(() => category.Name)" />
    </div>

    <div class="mb-3">
        <label>Description:</label>
        <InputText @bind-Value="category.Description" class="form-control" />
        <ValidationMessage For="@(() => category.Description)" />
    </div>

    <div class="mb-3">
        <label>Icon:</label>
        <InputText @bind-Value="category.Icon" class="form-control" placeholder="e.g., 🛒" />
        <ValidationMessage For="@(() => category.Icon)" />
        <small class="text-muted">Use an emoji</small>
    </div>

    <div class="mb-3">
        <label>Color:</label>
        <input type="color" @bind="category.ColorCode" class="form-control" />
        <ValidationMessage For="@(() => category.ColorCode)" />
    </div>

    <div>
        <button type="submit" class="btn btn-primary">Save</button>
        <a href="/categories" class="btn btn-secondary">Cancel</a>
    </div>
</EditForm>

@code {
    private readonly Category category = new();

    private async Task HandleSubmit()
    {
        category.UserId = UserState.CurrentUserId;
        DbContext.Categories.Add(category);
        await DbContext.SaveChangesAsync();
        Navigation.NavigateTo("/categories");
    }
}
