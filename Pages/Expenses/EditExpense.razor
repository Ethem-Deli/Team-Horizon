@page "/expenses/edit/{Id:int}"
@using Microsoft.EntityFrameworkCore;
@inject ApplicationDbContext DbContext
@inject NavigationManager Navigation

<PageTitle>Edit Expense</PageTitle>

<h1>✏️ Edit Expense</h1>

@if (expense == null)
{
    <p><em>Loading...</em></p>
}
else
{
    <EditForm Model="@expense" OnValidSubmit="HandleSubmit">
        <div class="mb-3">
            <label>Amount:</label>
            <InputNumber @bind-Value="expense.Amount" class="form-control" />
        </div>

        <div class="mb-3">
            <label>Date:</label>
            <InputDate @bind-Value="expense.Date" class="form-control" />
        </div>

        <div class="mb-3">
            <label>Description:</label>
            <InputText @bind-Value="expense.Description" class="form-control" />
        </div>

        <div class="mb-3">
            <label>Category:</label>
            <InputSelect @bind-Value="expense.CategoryId" class="form-control">
                @foreach (var category in categories)
                {
                    <option value="@category.Id">@category.Icon @category.Name</option>
                }
            </InputSelect>
        </div>

        <div>
            <button type="submit" class="btn btn-primary">Save Changes</button>
            <a href="/expenses" class="btn btn-secondary">Cancel</a>
        </div>
    </EditForm>
}

@code {
    [Parameter]
    public int Id { get; set; }

    private Expense? expense;
    private List<Category> categories = new();

    protected override async Task OnInitializedAsync()
    {
        expense = await DbContext.Expenses.FindAsync(Id);
        categories = await DbContext.Categories.ToListAsync();
    }

    private async Task HandleSubmit()
    {
        await DbContext.SaveChangesAsync();
        Navigation.NavigateTo("/expenses");
    }
}