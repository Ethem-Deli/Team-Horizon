@page "/budgets/overview/{year:int}/{month:int}"
@using Microsoft.EntityFrameworkCore
@inject ApplicationDbContext DbContext
@inject IBudgetService BudgetService
@inject IExpenseService ExpenseService
@inject UserState UserState

<PageTitle>Budget Overview</PageTitle>

<h2>Budget Overview</h2>

@if (budget == null)
{
    <p>Loading...</p>
} 
else
{
    <div class="card p-3 mb-3">
        <h4>@GetMonthName(budget.Month) @budget.Year</h4>

        <p><strong>Budget Amount:</strong> $@budget.Amount</p>
        <p><strong>Total Spent:</strong> $@totalSpent</p>
        <p><strong>Remaining:</strong> $@(budget.Amount - totalSpent)</p>
    </div>
}

@code {
    [Parameter] public int year { get; set; }
    [Parameter] public int month { get; set; }

    private Budget? budget;
    private List<Expense>? expenses;
    private decimal totalSpent;

    protected override async Task OnInitializedAsync()
    {
        budget = await BudgetService.GetBudgetAsync(UserState.CurrentUserId, year, month);

        if (budget != null)
        {
            var start = new DateTime(year, month, 1);
            expenses = await ExpenseService.GetExpensesForMonthAsync(UserState.CurrentUserId, start);
            totalSpent = expenses.Sum(e => e.Amount);
        }
    }

    private string GetMonthName(int month)
    {
        return new DateTime(2000, month, 1).ToString("MMMM");
    }
}